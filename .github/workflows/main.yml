name: Monstro V18 - Build Final Real

on:
  push:
    branches: [ "principal", "main" ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4

    - name: set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'

    - name: Gerar Motor (Fixo)
      run: |
        gradle wrapper --gradle-version 8.4
        chmod +x gradlew

    - name: Injetar Codigo Estavel
      run: |
        echo "### LIMPANDO E REESCREVENDO MAINACTIVITY ###"
        # Cria a pasta caso ela tenha sumido ou mudado de nome
        mkdir -p app/src/main/java/com/monstro/v18
        
        # Injeta a versão simplificada mas funcional do editor
        cat <<EOF > app/src/main/java/com/monstro/v18/MainActivity.kt
        package com.monstro.v18
        import android.os.Bundle
        import androidx.activity.ComponentActivity
        import androidx.activity.compose.setContent
        import androidx.compose.foundation.layout.*
        import androidx.compose.material3.*
        import androidx.compose.ui.Alignment
        import androidx.compose.ui.Modifier
        import androidx.compose.ui.graphics.Color
        import androidx.compose.ui.unit.dp

        class MainActivity : ComponentActivity() {
            override fun onCreate(savedInstanceState: Bundle?) {
                super.onCreate(savedInstanceState)
                setContent {
                    Surface(modifier = Modifier.fillMaxSize(), color = Color(0xFF020306)) {
                        Column(horizontalAlignment = Alignment.CenterHorizontally, verticalArrangement = Arrangement.Center) {
                            Text("MONSTRO V18", color = Color.White)
                            Spacer(Modifier.height(20.dp))
                            Button(onClick = { }) { Text("BUSCAR VÍDEO") }
                        }
                    }
                }
            }
        }
        EOF

    - name: Compilar APK Final
      run: ./gradlew clean :app:assembleDebug --no-daemon --stacktrace
