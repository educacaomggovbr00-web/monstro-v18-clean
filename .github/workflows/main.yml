name: Monstro V18 - Reset Total

on:
  push:
    branches: [ "principal", "main" ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4

    - name: set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'

    - name: Motor Estavel
      run: |
        gradle wrapper --gradle-version 8.4
        chmod +x gradlew

    - name: Limpeza e Injeção de Segurança
      run: |
        # Deleta as pastas de build antigas que podem estar travando em 1m
        rm -rf app/build
        mkdir -p app/src/main/java/com/monstro/v18
        
        # Injeta o código que deu 'SISTEMA OK' no seu print
        cat <<EOF > app/src/main/java/com/monstro/v18/MainActivity.kt
        package com.monstro.v18
        import android.os.Bundle
        import androidx.activity.ComponentActivity
        import androidx.activity.compose.setContent
        import androidx.compose.material3.Text
        import androidx.compose.ui.Alignment
        import androidx.compose.foundation.layout.Box
        import androidx.compose.foundation.layout.fillMaxSize
        import androidx.compose.ui.Modifier

        class MainActivity : ComponentActivity() {
            override fun onCreate(savedInstanceState: Bundle?) {
                super.onCreate(savedInstanceState)
                setContent {
                    Box(modifier = Modifier.fillMaxSize(), contentAlignment = Alignment.Center) {
                        Text("MONSTRO V18 - VOLTOU A FUNCIONAR")
                    }
                }
            }
        }
        EOF

    - name: Build de Recuperacao
      run: ./gradlew clean :app:assembleDebug --no-daemon
